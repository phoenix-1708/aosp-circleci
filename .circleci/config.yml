version: 2.1
jobs:
  compile:
   docker:
    - image: inok2341/anu:latest
      auth:
   resource_class: large
   steps:
      - run:
          command: |
           curl -s https://api.telegram.org/$tokentl/sendMessage -d chat_id=$idtl -d text="Setup Build"
           export DEBIAN_FRONTEND=noninteractive
           apt update
           apt install sudo
           mkdir -p ~/.config/rclone
           echo "$rcloneconfig" > ~/.config/rclone/rclone.conf
           DEBIAN_FRONTEND=noninteractive
           sudo apt install python3 -y
           sudo ln -sf /usr/bin/python3 /usr/bin/python
           git config --global user.name "phoenix-1708"
           git config --global user.email "harikumar1708@gmail.com"
           git config --global color.ui true
           mkdir -p /tmp/ccache
           rclone copy remote:ccache/ci2/ccache.tar.gz /tmp -P
           cd /tmp
           time tar xf ccache.tar.gz
           cd /tmp
           echo "============================"
           echo "Syncing The Sources..."
           echo "============================"
           curl -s https://api.telegram.org/$tokentl/sendMessage -d chat_id=$idtl -d text="Start sync Source"
           cd /tmp/rom
           repo init -q --no-repo-verify --depth=1 -u https://github.com/Evolution-X/manifest -b snow -g default,-mips,-darwin,-notdefault
      # DT/VT/KT/TC
           git clone https://github.com/phoenix-1708/local_manifest.git --depth=1 -b evox12 .repo/local_manifests
           repo sync -c --no-clone-bundle --no-tags --optimized-fetch --prune --force-sync
           curl -s https://api.telegram.org/$tokentl/sendMessage -d chat_id=$idtl -d text="Sync Completed!"
           echo "============================"
           echo "Sync Completed!"
           echo "============================"
           echo "============================"
           #Building
           echo "Starting the Build..."
           echo "============================"
           cd /tmp/rom
           export CCACHE_DIR=/tmp/ccache
           export CCACHE_EXEC=$(which ccache)
           export USE_CCACHE=1
           ccache -M 20G
           ccache -o compression=true
           ccache -z
           source build/envsetup.sh > /dev/null 2>&1
           lunch evolution_sweet-userdebug > /dev/null 2>&1
           curl -s https://api.telegram.org/$tokentl/sendMessage -d chat_id=$idtl -d text="$(echo "${var_cache_report_config}")"
           export ALLOW MISSING DEPENDENCIES=true
           export SKIP_ABI_CHECKS=true
           export SKIP_API_CHECKS=true
           mka evolution -j$(nproc --all)
           curl -s https://api.telegram.org/$tokentl/sendMessage -d chat_id=$idtl -d text="Build $(cd /tmp/rom/out/target/product/sweet/ && ls *.zip) Completed!"
           echo "Uploading the Build...."
           curl -s https://api.telegram.org/$tokentl/sendMessage -d chat_id=$idtl -d text="Uploading Build $(cd /tmp/rom/out/target/product/sweet/ && ls *.zip)"
           rclone copy /tmp/rom/out/target/product/laurel_sprout/*.zip remote:sweet -P
           curl -s https://api.telegram.org/$tokentl/sendMessage -d chat_id=$idtl -d text="Build $(cd /tmp/rom/out/target/product/sweet/ && ls *.zip) Uploaded Successfully!"
           curl -s https://api.telegram.org/$tokentl/sendMessage -d chat_id=$idtl -d text="Download link https://withered-lab-e844.harikumar1708.workers.dev/sweet/$(cd /tmp/rom/out/target/product/sweet/ && ls *.zip)"
           curl -s https://api.telegram.org/$tokentl/sendMessage -d chat_id=$idtl -d text="Compres ccache"
           git clone https://github.com/phoenix-1708/anu.git && cd anu
           bash ziping.sh
           cd /tmp
           curl -s https://api.telegram.org/$tokentl/sendMessage -d chat_id=$idtl -d text="Uploading ccache...."
           rclone copy ccache.tar.gz remote:ccache/ci2 -P
           echo "Build Uploaded Successfully!"
           
           
           
workflows:
  version: 2.1
  cooking:
    jobs:
      - compile
